#!/bin/sh

# script/build - compiles the application.

# exit on sub-module failure
set -e

cd "$(dirname "$0")/.."

# ------

sh script/clean
sh script/bootstrap

# ------

version=${1:-1.0.0.0}

# build
xbuild Src/Stored.sln /target:Rebuild /property:Configuration=Release /property:Platform="Any CPU" /property:BUILD_VERSION=${version}

# test
nuget install xunit.runner.console -Version 2.1.0 -o Src/packages
mono --runtime=v4.0 Src/packages/xunit.runner.console.2.1.0/tools/xunit.console.exe -noappdomain Src/Stored.Tests/bin/Release/Stored.Tests.dll

# package
sh script/package ${version}

# --------
